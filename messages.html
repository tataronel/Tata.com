<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Messages</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container">
    <h2>Anonymous Messages</h2>
    <div id="messagesContainer"></div>
    <p><a href="submit.html" class ="button-link">Submit Another Message</a></p>
    
  </div>

  <script>
    const userId = localStorage.getItem("user_id") || generateUserId();
    function generateUserId() {
      const id = `user_${Math.random().toString(36).substr(2, 9)}`;
      localStorage.setItem("user_id", id);
      return id;
    }

    function loadMessages() {
      const container = document.getElementById("messagesContainer");
      const messages = JSON.parse(localStorage.getItem("messages") || "[]");
      container.innerHTML = "";

      messages.forEach((msg, index) => {
        const box = document.createElement("div");
        box.className = "message-box";

        const text = document.createElement("p");
        text.textContent = msg.text;
        box.appendChild(text);

        const hasReacted = msg.reactedUsers && msg.reactedUsers.includes(userId);

        const reactions = document.createElement("div");
        reactions.className = "reactions";

        for (let emoji in msg.reactions) {
          const span = document.createElement("span");
          span.className = "emoji";
          span.innerHTML = `${emoji} <span>${msg.reactions[emoji]}</span>`;

          if (!hasReacted) {
            span.onclick = () => {
              messages[index].reactions[emoji]++;
              if (!messages[index].reactedUsers) {
                messages[index].reactedUsers = [];
              }
              messages[index].reactedUsers.push(userId);
              localStorage.setItem("messages", JSON.stringify(messages));
              loadMessages(); // Refresh UI
            };
          } else {
            span.style.opacity = 0.6;
            span.title = "You already reacted";
          }

          reactions.appendChild(span);
        }

        box.appendChild(reactions);
        container.appendChild(box);
      });
    }

    loadMessages();
  </script>
</body>
</html>
